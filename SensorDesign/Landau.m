%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Landau function implementation as from P.D.G. %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

function y = Landau(x,mpv,sigma,norm)

p1 = [0.4259894875,-0.1249762550, 0.03984243700, -0.006298287635,   0.001511162253];
q1 = [1.0         ,-0.3388260629, 0.09594393323, -0.01608042283,    0.003778942063];

p2 = [0.1788541609, 0.1173957403, 0.01488850518, -0.001394989411,   0.0001283617211];
q2 = [1.0         , 0.7428795082, 0.3153932961,   0.06694219548,    0.008790609714];

p3 = [0.1788544503, 0.09359161662,0.006325387654, 0.00006611667319,-0.000002031049101];
q3 = [1.0         , 0.6097809921, 0.2560616665,   0.04746722384,    0.006957301675];

p4 = [0.9874054407, 118.6723273,  849.2794360,   -743.7792444,      427.0262186];
q4 = [1.0         , 106.8615961,  337.6496214,    2016.712389,      1597.063511];

p5 = [1.003675074,  167.5702434,  4789.711289,    21217.86767,     -22324.94910];
q5 = [1.0         , 156.9424537,  3745.310488,    9834.698876,      66924.28357];

p6 = [1.000827619,  664.9143136,  62972.92665,    475554.6998,     -5743609.109];
q6 = [1.0         , 651.4101098,  56974.73333,    165917.4725,     -2815759.939];

a1 = [0.04166666667,-0.01996527778, 0.02709538966];

a2 = [-1.845568670,-4.284640743];

if (sigma <= 0)    
    y = 0;
    return;
end;
v = (x - mpv) / sigma;

if (v < -5.5)
    u   = exp(v+1);
    if (u < 1e-10)
        y = 0.0;
        return;
    end;
    
    ue  = exp(-1/u);
    us  = sqrt(u);
    den = 0.3989422803*(ue/us)*(1+(a1(1)+(a1(2)+a1(3)*u)*u)*u);
    
elseif(v < -1)
    u   = exp(-v-1);
    den = exp(-u)*sqrt(u)*(p1(1)+(p1(2)+(p1(3)+(p1(4)+p1(5)*v)*v)*v)*v)/(q1(1)+(q1(2)+(q1(3)+(q1(4)+q1(5)*v)*v)*v)*v);
elseif(v < 1)
    den = (p2(1)+(p2(2)+(p2(3)+(p2(4)+p2(5)*v)*v)*v)*v)/(q2(1)+(q2(2)+(q2(3)+(q2(4)+q2(5)*v)*v)*v)*v);
elseif(v < 5)
    den = (p3(1)+(p3(2)+(p3(3)+(p3(4)+p3(5)*v)*v)*v)*v)/(q3(1)+(q3(2)+(q3(3)+(q3(4)+q3(5)*v)*v)*v)*v);
elseif(v < 12)
    u   = 1/v;
    den = u*u*(p4(1)+(p4(2)+(p4(3)+(p4(4)+p4(5)*u)*u)*u)*u)/(q4(1)+(q4(2)+(q4(3)+(q4(4)+q4(5)*u)*u)*u)*u);
elseif(v < 50)
    u   = 1/v;
    den = u*u*(p5(1)+(p5(2)+(p5(3)+(p5(4)+p5(5)*u)*u)*u)*u)/(q5(1)+(q5(2)+(q5(3)+(q5(4)+q5(5)*u)*u)*u)*u);
elseif(v < 300)
    u   = 1/v;
    den = u*u*(p6(1)+(p6(2)+(p6(3)+(p6(4)+p6(5)*u)*u)*u)*u)/(q6(1)+(q6(2)+(q6(3)+(q6(4)+q6(5)*u)*u)*u)*u);
else
    u   = 1/(v-v*log(v)/(v+1));
    den = u*u*(1+(a2(1)+a2(2)*u)*u);
end;

if (not(norm))
    y = den;
    return;
end;

y = den/sigma;

end